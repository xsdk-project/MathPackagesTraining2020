<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hand Coded Heat</title>

    <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive.css">

  

	<script src="http://localhost:4000/assets/js/modernizr.min.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
	<script>
		WebFont.load({
			google: {
				families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ]
			}
		});
	</script>

	<noscript>
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'>
	</noscript>


	<!-- Search Engine Optimization -->
	<meta name="description" content="Why use numerical packages...">
	<meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ">
	<meta name="msvalidate.01" content="0FB4C028ABCF07C908C54386ABD2D97F" >
	
	<link rel="author" href="https://plus.google.com/u/0/118311555303973066167">
	
	
	<link rel="canonical" href="http://localhost:4000/lessons/hand_coded_heat/">


	<!-- Facebook Open Graph -->
	<meta property="og:title" content="Hand Coded Heat">
	<meta property="og:description" content="Why use numerical packages...">
	<meta property="og:url" content="http://localhost:4000/lessons/hand_coded_heat/">
	<meta property="og:locale" content="en_EN">
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="ATPESC 2018 Math Library Hands On Exercises">
	
	<meta property="article:author" content="https://www.facebook.com/phlow.media">


	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="phlow">
	<meta name="twitter:creator" content="phlow">
	<meta name="twitter:title" content="Hand Coded Heat">
	<meta name="twitter:description" content="Why use numerical packages...">
	
	

	<link type="text/plain" rel="author" href="http://localhost:4000/humans.txt">

	

	

	<link rel="icon" sizes="32x32" href="http://localhost:4000/assets/img/favicon-32x32.png">

	<link rel="icon" sizes="192x192" href="http://localhost:4000/assets/img/touch-icon-192x192.png">

	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://localhost:4000/assets/img/apple-touch-icon-180x180-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/assets/img/apple-touch-icon-152x152-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/img/apple-touch-icon-144x144-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/assets/img/apple-touch-icon-120x120-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/img/apple-touch-icon-114x114-precomposed.png">

	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/assets/img/apple-touch-icon-76x76-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/img/apple-touch-icon-72x72-precomposed.png">

	<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/assets/img/apple-touch-icon-precomposed.png">	

	<meta name="msapplication-TileImage" content="http://localhost:4000/assets/img/msapplication_tileimage.png">

	<meta name="msapplication-TileColor" content="#fabb00">


	

        
	   <!-- MathJax Config
                    CommonHTML: {
                        scale: 200
                    }
            <script type="text/x-mathjax-config">
                MathJax.Hub.Config({
                    displayAlign: "left"
                });
            </script>
            -->
            <script type="text/javascript" async
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async>
            </script>
            <script type="text/x-mathjax-config">
                MathJax.Hub.Config({
                    TeX: { 
                        equationNumbers: {  autoNumber: "all"  }
                    }
                });
            </script>
        

</head>
<body id="top-of-page" class="page-fullwidth">
        

	
	
<div id="navigation" class="sticky">
  <nav class="top-bar" role="navigation" data-topbar>
    <ul class="title-area">
      <li class="name">
      <h1 class="show-for-small-only"><a href="http://localhost:4000" class="icon-tree"> ATPESC 2018 Math Library Hands On Exercises</a></h1>
    </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span>Nav</span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        
              

              

          
          
        
              

              

          
          
        
              

              

          
          
        
              

              

          
          
        
        
      </ul>

      <ul class="left">
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/">Intro</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/about_your_day/">About Your Day</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/setup_instructions/">Setup Instructions</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/atpesc_2018_agenda/">Today&#39;s Agenda</a></li>
                    

                      

                      <li><a  href="https://www.alcf.anl.gov/user-guides" target="_blank">ALCF User Guides</a></li>
                    

                      

                      <li><a  href="https://hangouts.google.com/group/wuWDDdPe4mX1u0v83" target="_blank">Open Chat</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/pages/one_on_one_schedule.html">One-on-One Schedule</a></li>
                    

                      

                      <li><a  href="https://goo.gl/forms/B7UFpBvEOJbC58oJ2" target="_blank">Submit a Show Your Work</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/lessons/">Lessons</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/lessons/hand_coded_heat/">Hand Coded Heat</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/mfem_convergence/">Meshing and Discretization (MFEM)</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/pumi/">MFEM+PUMI Adaptive Workflow</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/time_integrators/">Time Integration &amp; Non-Linear Solvers</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/krylov_amg/">Krylov Solvers and Algebraic Multigrid</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/superlu_mfem/">Sparse Direct Solvers</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/adjoint/">Numerical Optimization (Adjoint)</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/obstacle_tao">Numerical Optimization</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="https://fastmath-scidac.org/software-catalog.html" target="_blank">Packages</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://mfem.org" target="_blank">MFEM</a></li>
                    

                      

                      <li><a  href="https://www.scorec.rpi.edu/pumi" target="_blank">PUMI</a></li>
                    

                      

                      <li><a  href="https://www.mcs.anl.gov/petsc/" target="_blank">PETSc</a></li>
                    

                      

                      <li><a  href="https://computation.llnl.gov/projects/hypre-scalable-linear-solvers-multigrid-methods" target="_blank">HYPRE</a></li>
                    

                      

                      <li><a  href="http://crd-legacy.lbl.gov/~xiaoye/SuperLU" target="_blank">SuperLU</a></li>
                    

                      

                      <li><a  href="http://www.mcs.anl.gov/research/projects/tao/tao-deprecated/index.html" target="_blank">Tao</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/contributing_guide/">Contributing</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/contributing_guide/">Contributing Guide</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/info/">Why the new theme?</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/headers/">Many Header Styles</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/design/">Many Design Options</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/documentation/">Full Documentation</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->

	

	

<div id="masthead">
	<div class="row">
		<div class="small-12 columns">
			<a id="logo" href="http://localhost:4000/" title="ATPESC 2018 Math Library Hands On Exercises – So my code will see the future">
				<img src="http://localhost:4000/assets/img/logo.png" alt="ATPESC 2018 Math Library Hands On Exercises – So my code will see the future">
			</a>
		</div><!-- /.small-12.columns -->
	</div><!-- /.row -->
</div><!-- /#masthead -->










	


<div class="row t30">
	<div class="medium-12 columns">
		<article>
			<header>
				<p class="subheadline">Hello World for Numerical Packages</p>
				<h1>Hand Coded Heat</h1>
			</header>

			
			<p class="teaser">
				Why use numerical packages...
			</p>
			

			<h2 id="at-a-glance">At a Glance</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Questions</th>
      <th style="text-align: left">Objectives</th>
      <th style="text-align: left">Key Points</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">What is a numerical algorithm?</td>
      <td style="text-align: left">Implement a simple numerical algorithm.<br />Use it to solve a simple science problem.</td>
      <td style="text-align: left">Numerical Packages are used<br />to solve scientific problems<br />involving <a href="https://en.wikipedia.org/wiki/Partial_differential_equation">PDEs.</a></td>
    </tr>
    <tr>
      <td style="text-align: left">What is <a href="https://en.wikipedia.org/wiki/Discretization">discretization</a>?</td>
      <td style="text-align: left">Introduce basic concepts in solving continuous<br /><a href="https://en.wikipedia.org/wiki/Partial_differential_equation">PDEs</a> using discrete computations.</td>
      <td style="text-align: left"><em>Meshing</em> (or <a href="https://en.wikipedia.org/wiki/Discretization">discretization</a>) is an<br />important first step.</td>
    </tr>
    <tr>
      <td style="text-align: left">How can numerical packages<br />help me with my software?</td>
      <td style="text-align: left">Understand the value numerical packages<br />offer in developing science applications</td>
      <td style="text-align: left">Numerical packages offer many advantages<br />including: rigorous/vetted numerics<br />increased generality, extreme scalability,<br />performance portability, enhanced reproducibility<br />and many others…</td>
    </tr>
  </tbody>
</table>

<h4 id="to-begin-this-lesson">To begin this lesson</h4>

<ul>
  <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSdoyXOL4UCe4_p0SheNidqY_ErKcrRS2qqqomIHQMZi5eVM2g/viewform?usp=sf_link" target="_blank">Open the Answers Form</a></li>
  <li>Go to the directory for the hand-coded <code class="highlighter-rouge">heat</code> application
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd HandsOnLessons/hand_coded_heat
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="a-simple-science-question">A Simple Science Question</h2>

<p>Lets say you live in a house with exterior walls made of a single material of thickness, <script type="math/tex">L_x</script>.
Inside the walls are some water pipes as pictured below.</p>

<p><img src="/lessons/hand_coded_heat/wall_and_pipe.png" alt="Wall and Pipe::" /></p>

<p>You keep the inside temperature of the house always at 70 degrees F. But, there is an
overnight storm coming. The temperature is expected to drop to -40 degrees F. Will your
pipes freeze before the storm is over?</p>

<h3 id="governing-equations">Governing Equations</h3>

<p>In this lesson, we demonstrate the implementation and use of a hand-coded
(e.g., does not use any numerical packages) C-language application to
model the one dimensional <em>heat</em> conduction equation through a wall as
pictured here …</p>

<p>In general, heat <a href="https://en.wikipedia.org/wiki/Thermal_conduction">conduction</a> is governed
by the partial differential (<a href="https://en.wikipedia.org/wiki/Partial_differential_equation">PDE</a>)…</p>

<script type="math/tex; mode=display">\frac{\partial u}{\partial t} - \nabla \cdot \alpha \nabla u = 0</script>

<p>where <em>u</em> is the temperature within the wall at spatial positions, <em>x</em>, and times, <em>t</em>, \( \alpha \),
is the <em>thermal diffusivity</em>
of the material(s) comprising the wall. This equation is known as the
<em>Diffusion Equation</em> and also the <a href="https://en.wikipedia.org/wiki/Heat_equation"><em>Heat Equation</em></a>.</p>

<h3 id="simplifying-assumptions">Simplifying Assumptions</h3>

<p>To make the problem tractable for this short lesson, we make some simplifying assumptions…</p>

<ol>
  <li>The thermal diffusivity, \( \alpha \)
is constant for all <em>space</em> and <em>time</em>.</li>
  <li>The only heat <em>source</em> is from the initial and/or boundary conditions.</li>
  <li>We will deal only with the <em>one dimensional</em> problem in <em>Cartesian coordinates</em>.</li>
  <li>We will <em><a href="https://en.wikipedia.org/wiki/Discretization">discretize</a></em> with constant spacing in both space, <script type="math/tex">\Delta x</script> and time, <script type="math/tex">\Delta t</script>.</li>
</ol>

<p>In this case, the <a href="https://en.wikipedia.org/wiki/Partial_differential_equation">PDE</a> we need to develop an application to solve simplifies to…</p>

<script type="math/tex; mode=display">\frac{\partial u}{\partial t} = \alpha \frac{\partial^2 u}{\partial x^2}</script>

<h2 id="discretization">Discretization</h2>

<p>The equation above is a <em>continuous</em>,
<a href="https://en.wikipedia.org/wiki/Partial_differential_equation">partial differential equation (PDE)</a>
In order to write a computer program to solve this equation, numerically, the first thing
we need to consider is how to <em><a href="https://en.wikipedia.org/wiki/Discretization">discretize</a></em>
the equation into a form suitable for numerical computation.</p>

<p>Consider discretizing, independently, the left- and right-hand sides of
equation 2. For the left-hand side, we can approximate the first derivative
of <em>u</em> with respect to time, <em>t</em>, by the equation…</p>

<script type="math/tex; mode=display">\frac{\partial u}{\partial t} \Bigr\vert_{t_{k+1}} \approx \frac{u_i^{k+1}-u_i^k}{\Delta t}</script>

<p>We can approximate the right-hand side of equation 2 with
the second derivative of <em>u</em> with respect to space, <em>x</em>, by the equation…</p>

<script type="math/tex; mode=display">\alpha \frac{\partial^2 u}{\partial x^2}\Bigr\vert_{x_i} \approx \alpha \frac{u_{i-1}^k-2u_i^k+u_{i+1}^k}{\Delta x^2}</script>

<p>Setting equations 3 and 4 equal to each other and re-arranging terms, we
arrive at the following update scheme for producing the temperatures at
the next time, <em>k+1</em>, from temperatures at the current time, <em>k</em>, as</p>

<script type="math/tex; mode=display">u_i^{k+1} = ru_{i+1}^k+(1-2r)u_i^k+ru_{i-1}^k</script>

<p>where \( r=\alpha\frac{\Delta t}{\Delta x^2} \)</p>

<div class="qanda">
  
  <input id="qanda_toggle1" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle1" style="font-size:150%">Is there anything here that looks like a <em>mesh</em>?
</label>
  <div id="qanda_expand1">
    <style>
      #qanda_toggle1:checked ~ #qanda_expand1 {
        
        
        
        
            height: 39vmin;
        
      }
    </style>
    <section>
      
          
<p>In the process of discretizing the PDE, we have defined a fixed spacing in x
and a fixed spacing in t as shown in the figure here</p>

<p><a href="/lessons/hand_coded_heat/heat_mesh.png" align="middle"><img src="heat_mesh.png" width="320" /></a></p>

<p>This is essentially a uniform mesh. Later lessons
here address more sophisticated discretizations in space and in time which
depart from these all too inflexible fixed spacings.</p>


      
    </section>
  </div>
</div>

<p>Note that this equation now defines the solution at spatial position <em>i</em> and time <em>k+1</em>
in terms of values of u at time <em>k</em> .  This is an
<a href="https://en.wikipedia.org/wiki/Explicit_and_implicit_methods"><em>explicit</em></a>
numerical method known as the
<em><a href="https://en.wikipedia.org/wiki/FTCS_scheme">forward in time, centered difference (FTCS)</a></em>
 algorithm. As an explicit method, it has some nice properties:</p>

<ul>
  <li>They are easy to implement.</li>
  <li>They typically require minimal memory.</li>
  <li>They are easy to parallelize.</li>
</ul>

<hr />

<h2 id="exercise-1-implement-the-ftcs-algorithm-2-mins">Exercise #1: Implement the FTCS Algorithm (2 mins)</h2>

<p>The function, <code class="highlighter-rouge">solution_update_ftcs</code>, is defined below without its body.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span>
<span class="nf">solution_update_ftcs</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span>              <span class="c1">// # of temperature samples in space</span>
    <span class="n">Double</span> <span class="o">*</span><span class="n">uk1</span><span class="p">,</span>        <span class="c1">// new temperatures @ t = k+1</span>
    <span class="n">Double</span> <span class="k">const</span> <span class="o">*</span><span class="n">uk0</span><span class="p">,</span>  <span class="c1">// old/last temperatures @ t = k</span>
    <span class="n">Double</span> <span class="n">alpha</span><span class="p">,</span>       <span class="c1">// thermal diffusivity</span>
    <span class="n">Double</span> <span class="n">dx</span><span class="p">,</span>          <span class="c1">// spacing in space, x</span>
    <span class="n">Double</span> <span class="n">dt</span><span class="p">,</span>          <span class="c1">// spacing in time, t</span>
    <span class="n">Double</span> <span class="n">bc_0</span><span class="p">,</span>        <span class="c1">// boundary condition @ x=0</span>
    <span class="n">Double</span> <span class="n">bc_1</span>         <span class="c1">// boundary condition @ x=Lx</span>
<span class="p">)</span>
<span class="p">{</span>
</code></pre></div></div>

<div class="qanda">
  
  <input id="qanda_toggle2" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle2" style="font-size:150%">Using eq. 5, implement the body of this function
</label>
  <div id="qanda_expand2">
    <style>
      #qanda_toggle2:checked ~ #qanda_expand2 {
        
        
        
        
            height: 34vmin;
        
      }
    </style>
    <section>
      
          
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Double const r = alpha * dt / (dx * dx);

    // Sanity check for stability
    if (r &gt; 0.5) return false;

    // Update the solution using FTCS algorithm
    for (int i = 1; i &lt; n-1; i++)
        uk1[i] = r*uk0[i+1] + (1-2*r)*uk0[i] + r*uk0[i-1];

    // Impose boundary conditions for solution indices i==0 and i==n-1
    curr[0  ] = bc_0;
    curr[n-1] = bc_1;

    return true;
</code></pre></div></div>


      
    </section>
  </div>
</div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>}
</code></pre></div></div>

<p>Open ftcs.C and implement the FTCS numerical algorithm by coding the body of this function.</p>

<h2 id="exercise-2-build-and-test-the-application-1-min">Exercise #2: Build and Test the Application (1 min)</h2>

<p>To compile the code you have just written…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<h4 id="a-simple-sanity-check-run">A Simple Sanity Check Run</h4>
<p>As a sanity check, lets just run the application with no arguments and see what
happens…</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% ./heat
    runame="heat_results"
    prec="double"
    alpha=0.2
    lenx=1
    dx=0.1
    dt=0.004
    maxt=2
    bc0=0
    bc1=1
    ic="const(1)"
    alg="ftcs"
    savi=0
    save=0
    outi=100
    noout=0
Iteration 0000: last change l2=0.0909091
Iteration 0100: last change l2=2.42918e-06
Iteration 0200: last change l2=4.86446e-07
Iteration 0300: last change l2=1.00929e-07
Iteration 0400: last change l2=2.09483e-08
Iteration 0500: last change l2=4.41684e-09
Counts: Adds:24500, Mults:25001, Divs:1005, Bytes:176
</code></pre></div></div>
<p>Before running, the application dumps its command-line arguments so the user can
see what parameters it was passed to run. In this case, you are seeing the default
values. It then runs the problem as defined by the command-line arguments and
saves result files to the directory specified by the <code class="highlighter-rouge">runame=</code> argument.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% ls -1t | head -n 1
heat_results
% file heat_results/*.*
heat_results/clargs.out:                    ASCII text
heat_results/heat_results_soln_00000.curve: ASCII text
heat_results/heat_results_soln_final.curve: ASCII text
</code></pre></div></div>
<p>For this simple application, the results are uncomplicated. They are simple ascii
text files containing x/y pairs of the computed numerical results.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% cat heat_results/heat_results_soln_final.curve
# Temperature
       0        0
     0.1   0.1039
     0.2   0.2073
     0.3   0.3101
     0.4   0.4119
     0.5   0.5125
     0.6   0.6119
     0.7   0.7101
     0.8   0.8073
     0.9   0.9039
       1        1
</code></pre></div></div>

<h4 id="getting-help">Getting Help</h4>

<p>Now that we have built the application, at any point, we can get help
regarding various options for the <code class="highlighter-rouge">heat</code> application like so…</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Usage: ./heat &lt;arg&gt;=&lt;value&gt; &lt;arg&gt;=&lt;value&gt;...
    runame="heat"                       name to give run and results dir (char*)
    alpha=0.2           material thermal diffusivity (sq-meters/second) (double)
    lenx=1                                     material length (meters) (double)
    dx=0.1                  x-incriment. Best if lenx/dx==int. (meters) (double)
    dt=0.004                                      t-increment (seconds) (double)
    maxt=2         &gt;0:max sim time (seconds) | &lt;0:min l2 change in soln (double)
    bc0=0                     boundary condition @ x=0: u(0,t) (Kelvin) (double)
    bc1=1               boundary condition @ x=lenx: u(lenx,t) (Kelvin) (double)
    ic="const(1)"               initial condition @ t=0: u(x,0) (Kelvin) (char*)
    alg="ftcs"                            algorithm ftcs|upwind15|crankn (char*)
    savi=0                                   save every i-th solution step (int)
    save=0                              save error in every saved solution (int)
    outi=100                      output progress every i-th solution step (int)
    noout=0                                       disable all file outputs (int)
    prec="double"                       precision half|float|double|quad (char*)
Examples...
    ./heat dx=0.01 dt=0.0002 alg=ftcs
    ./heat dx=0.1 bc0=273 bc1=273 ic="spikes(273,5,373)"
</code></pre></div></div>

<p>See the <a href="#icarg">note below</a> regarding more information on the <code class="highlighter-rouge">ic</code> argument to
specify a variety of initial conditions.</p>

<p>When the <code class="highlighter-rouge">heat</code> application runs, by default it will store three files in a
directory named <code class="highlighter-rouge">runame</code></p>

<h3 id="testing-the-heat-application">Testing The heat Application</h3>

<p>Before we use our new application to solve our simple science question, how can we assure
ourselves that the code we have written is correct or, at the very least, sanity check
ourselves that there isn’t anything glaringly incorrect?</p>

<div class="qanda">
  
  <input id="qanda_toggle3" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle3" style="font-size:150%">Can you think ways to test the application?
</label>
  <div id="qanda_expand3">
    <style>
      #qanda_toggle3:checked ~ #qanda_expand3 {
        
        
        
        
            height: 10vmin;
        
      }
    </style>
    <section>
      
          
<ul>
  <li>Compare it to known, validated numerical solutions.</li>
  <li>Compare it to known analytical solutions.</li>
</ul>

<p>In any case, think about how you would measure <em>error</em>.</p>

      
    </section>
  </div>
</div>

<p>We know, maybe even intuitively, that if we maintain constant temperatures at
<script type="math/tex">A @ x=0</script> and <script type="math/tex">B @ x=L_x</script>, then after a long time (e.g. when the solution
reaches <em><a href="https://en.wikipedia.org/wiki/Steady_state">steady state</a></em>), we
expect it to be a simple linear variation between temperatures A and B. For
example, observe what happens after a long time in the one dimensional example
below.</p>

<p><img src="/lessons/hand_coded_heat/Heat_Transfer.gif" alt="Evolution Towards Steady State ::" /></p>

<div class="qanda">
  
  <input id="qanda_toggle4" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle4" style="font-size:150%">Construct a suitable command-line to easily confirm a linear steady state
</label>
  <div id="qanda_expand4">
    <style>
      #qanda_toggle4:checked ~ #qanda_expand4 {
        
        
        
        
            height: 16vmin;
        
      }
    </style>
    <section>
      
          <p>Since the default length is 1 and the default boundary conditions are 0 and 1,
            we just need to run the problem for a long time. But, to be a little more
            thorough, it is even better to start with a random initial condition too.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% ./heat dx=0.25 maxt=100 ic="rand(125489,100,50)" runame=test
</code></pre></div></div>

      
    </section>
  </div>
</div>

<div class="qanda">
  
  <input id="qanda_toggle5" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle5" style="font-size:150%">How do you confirm results are indeed a linear steady state?
</label>
  <div id="qanda_expand5">
    <style>
      #qanda_toggle5:checked ~ #qanda_expand5 {
        
        
        
        
            height: 46vmin;
        
      }
    </style>
    <section>
      
          <p>Examine the initial and final results file and confirm even a random input
            still yields a final result where x==y for all rows of the results file</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% cat test/test_soln_00000.curve
# Temperature
       0    69.09
    0.25    143.6
     0.5     96.3
    0.75    52.61
       1    131.6
% cat test/test_soln_final.curve
# Temperature
       0        0
    0.25     0.25
     0.5      0.5
    0.75     0.75
       1        1
</code></pre></div></div>


      
    </section>
  </div>
</div>

<h2 id="exercise-3-use-applicaton-to-model-science-problem-of-interest">Exercise #3: Use Applicaton to Model Science Problem of Interest</h2>

<p>Lets now use our <code class="highlighter-rouge">heat</code> application to model our simple science question.</p>

<h3 id="additional-information--assumptions">Additional Information / Assumptions</h3>

<table>
  <tbody>
    <tr>
      <td>Material</td>
      <td>Thermal Diffusivity<br />(sq-meters/second)</td>
    </tr>
    <tr>
      <td>Wood</td>
      <td><script type="math/tex">8.2 \times 10^{-8}</script></td>
    </tr>
    <tr>
      <td>Adobe Brick</td>
      <td><script type="math/tex">2.7 \times 10^{-7}</script></td>
    </tr>
    <tr>
      <td>Common (red) Brick</td>
      <td><script type="math/tex">5.2 \times 10^{-7}</script></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Outside temp has been same as inside temp for a long time, 70 degrees F</li>
  <li>Night/Storm will last 15.5 hours @ -40 degrees F</li>
  <li>Walls are 0.25 meters thick wood and pipe is 0.1 meters in diameter</li>
  <li>Pipe will freeze if center point drops below freezing.</li>
</ul>

<p><strong>Note:</strong> An all too common issue in simulation applications is being sure data is
input in the correct units. Take care!</p>

<div class="qanda">
  
  <input id="qanda_toggle6" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle6" style="font-size:150%">Determine the command-line to run for our simple science problem?
</label>
  <div id="qanda_expand6">
    <style>
      #qanda_toggle6:checked ~ #qanda_expand6 {
        
        
        
        
            height: 10vmin;
        
      }
    </style>
    <section>
      
          <p>./heat runame=wall alpha=8.2e-10 lenx=0.25 dx=0.01 dt=100 outi=100 savi=1000 maxt=55800 bc0=233.15 bc1=294.261 ic=”const(294.261)”</p>

      
    </section>
  </div>
</div>

<h2 id="exercise-4-analyze-results-and-do-some-science">Exercise #4: Analyze Results and Do Some Science</h2>

<p>Its time to use the results from our simulation to answer the science question of interest.
Below we plot results</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make plot PTOOL=gnuplot RUNAME=wall
</code></pre></div></div>

<p>Depending on your situation, the above command may or may not produce a plot looking like below.</p>

<p><img src="/lessons/hand_coded_heat/pipe_solution.png" alt="Pipe Solution ::" width="400" /></p>

<div class="qanda">
  
  <input id="qanda_toggle7" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle7" style="font-size:150%">Will the pipes freeze?
</label>
  <div id="qanda_expand7">
    <style>
      #qanda_toggle7:checked ~ #qanda_expand7 {
        
        
        
        
            height: 10vmin;
        
      }
    </style>
    <section>
      
          <p>No</p>

      
    </section>
  </div>
</div>

<h2 id="custom-coded-solutions-are-a-slippery-slope">Custom Coded Solutions are a Slippery Slope</h2>

<p>We all like to write code and build useful tools. However, it is all too easy
to see the unfamiliar as an impediment rather than enabler in reaching our sience goals.
However, this is a slippery slope. We often start with relatively simple goals
and over time wish to evolve our software solutions to ever more challenging
science problems.</p>

<p>Examine the lines of code of the <em>complete application</em> here</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wc -l *.[Ch]
  125 args.C     # User interface
   94 crankn.C   # Alternative solver
   88 Double.H   # Performance tracking
   38 exact.C    # Testing support
   24 ftcs.C     # FTCS solver
  222 heat.C     # Main
   19 heat.H     # Modularization
   27 upwind15.C # Alternative solver
  151 utils.C    # Utilities, I/O, Data Formats
  788 total
</code></pre></div></div>

<p>Developing generally useful science applications involves many considerations and software
engineering challenges.</p>

<ul>
  <li>More than just one spatial dimension</li>
  <li>More complex geometric shapes and non-cartesian coordinate systems</li>
  <li>Heat sources and radiation</li>
  <li>Laminated, anisotropic or non-linear materials</li>
  <li>Much larger objects involving billions of discretization points and requiring scalability in all phases of the solution.</li>
  <li>Parallelism such as MPI, and/or, GPU and/or many core and/or various parallel runtimes</li>
  <li>Alternative and interoperable discretizations, solvers, time-integrators, optimizers</li>
  <li>An agile and sustainable software design and implementation addressing understandability of code, with encapsulation
of complexities, robustness, efficiency, scalability, portability, reproducibility, rigorous testing, etc.</li>
</ul>

<p>When we employ numerical packages, many of these issues are addressed for us allowing us to
focus more of our effort on the software engineering involved in developing
applications that address our science questions of interest.</p>

<hr />

<h2 id="evening-hands-on-session">Evening Hands On Session</h2>

<h3 id="short--quick-follow-on-questions">Short / Quick Follow-on Questions</h3>

<div class="qanda">
  
  <input id="qanda_toggle8" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle8" style="font-size:150%">Will the pipes freeze in a common brick wall of same thickness?
</label>
  <div id="qanda_expand8">
    <style>
      #qanda_toggle8:checked ~ #qanda_expand8 {
        
        
        
        
            height: 10vmin;
        
      }
    </style>
    <section>
      
          <p>Yes</p>

      
    </section>
  </div>
</div>

<div class="qanda">
  
  <input id="qanda_toggle9" type="checkbox" unchecked="" />
  <label class="qanda" for="qanda_toggle9" style="font-size:150%">What is the Optimum thickness of an Adobe Brick Wall?
</label>
  <div id="qanda_expand9">
    <style>
      #qanda_toggle9:checked ~ #qanda_expand9 {
        
        
        
        
            height: 10vmin;
        
      }
    </style>
    <section>
      
          <p>0.3-0.4 meters</p>

      
    </section>
  </div>
</div>

<h3 id="determine-optimum-wall-thicknesses">Determine Optimum Wall Thicknesses</h3>

<p>What are the minimum thicknesses of walls of Wood, Adobe and Common brick
to prevent the pipes from freezing?</p>

<p>When you are done, go to <code class="highlighter-rouge">Intro-&gt;Submit A Show Your Work</code> using the hands-on
activity name <em>Optimized Walls</em> and upload evidence of your completed solution.</p>

<h3 id="compare-ftcs-crank-nicholson-and-upwind15-algorithms-5-points">Compare FTCS, Crank-Nicholson and Upwind15 Algorithms (5 points)</h3>

<h4 id="crank-nicolson-discretization"><a href="https://en.wikipedia.org/wiki/Crank–Nicolson_method">Crank-Nicolson</a> Discretization</h4>

<p>Using the <a href="https://en.wikipedia.org/wiki/Crank–Nicolson_method">Crank-Nicolson</a> discretization,
we arrive at the following discretization of equation 2…</p>

<script type="math/tex; mode=display">-ru_{i+1}^{k+1}+(1+2r)u_i^{k+1}-ru_{i-1}^{k+1} = ru_{i+1}^k+(1-2r)u_i^k+ru_{i-1}^k</script>

<p>where</p>

<script type="math/tex; mode=display">r= \alpha \frac{\Delta t}{2 \Delta x^2}</script>

<p>In equation 7, the solution at spatial position <em>i</em> and time <em>k+1</em>
now depends not only on values of u at time <em>k</em> but also on other
values of u at time <em>k+1</em>.
This means each time we advance the solution in time we must
solve a linear system; in other words we must solve for all of the
values at time <em>k+1</em> in one step.
This is an example of an
<a href="https://en.wikipedia.org/wiki/Explicit_and_implicit_methods"><em>implicit</em></a> method.
In this case, the system of equations is
<a href="https://en.wikipedia.org/wiki/Tridiagonal_matrix_algorithm"><em>tri-diagonal</em></a> –
since each update for u at <em>i</em> only uses u at <em>i-1</em> , <em>i</em> and <em>i+1</em> –
so it is easier to implement than a general matrix solve but is still more complicated
than an explicit update.</p>

<p>The code to implement this method is more involved because it involves
doing a tri-diagonal solve. It is in <code class="highlighter-rouge">crankn.C</code>. It involves code that
sets up and LU factors the initial matrix. Then, the LU factored matrix
is used on each solution timestep to solve for the new temperatures.</p>

<p>Run the same problems using each of these algorithms and observe total
memory usage and operation counts (printed at the end) and provide your
explanations for them and in comparison with the FTCS method.</p>

<p>When you are done, go to <code class="highlighter-rouge">Intro-&gt;Submit A Show Your Work</code> using the hands-on
activity name <em>Crank-Nicholson</em> and upload evidence of your completed solution.</p>

<h3 id="use-the-application-to-solve-the-pipeline-problem-5-points">Use The Application to Solve The Pipeline Problem (5 points)</h3>

<p><img src="/lessons/hand_coded_heat/pipeline.png" alt="Pipeline Problem::" width="500" /></p>

<p>An pipeline carrying Ethenol-85 (E85) runs between a manure processing
facility and a kerosene production factory. In the unlikely event that
both facilities experience catastrophic explosion (burning methane at
the manure facility and burning kerosene at the kerosene facility),
that <em>briefly</em> increases the local air temperature on both sides of
the pipe to the burning temperature of the respective materials, determine
the minimum thermal diffusivity of the material used to coat/insulate the pipe
to prevent the E-85 from exploding. Assume the pipe is 36 inches in
diameter.</p>

<p>When you are done, go to <code class="highlighter-rouge">Intro-&gt;Submit A Show Your Work</code> using the hands-on
activity name <em>Pipeline</em> and upload evidence of your completed solution.</p>

<h3 id="modify-the-application-to-support-two-materials-10-points">Modify the Application to Support Two Materials (10 points)</h3>

<p>Using <a href="http://www.ams.org/journals/mcom/1960-14-072/S0025-5718-60-99228-0/S0025-5718-60-99228-0.pdf">other research</a>,
modify the application to work for a composite wall composed of two materials.</p>

<p>When you are done, go to <code class="highlighter-rouge">Intro-&gt;Submit A Show Your Work</code> using the hands-on activity
name <em>Composite Wall</em> and upload evidence of your completed solution.</p>

<hr />

<h3 id="a-note-about-the-ic-argument-to-heat">A note about the <code class="highlighter-rouge">ic=</code> argument to <code class="highlighter-rouge">heat</code></h3>

<p>The initial condition argument, <code class="highlighter-rouge">ic</code>, handles a few interesting cases</p>

<dl>
  <dt>Constant, <code class="highlighter-rouge">ic="const(V)"</code></dt>
  <dd>
    <p>Set initial condition to constant value, <code class="highlighter-rouge">V</code></p>
  </dd>
  <dt>Ramp, <code class="highlighter-rouge">ic="ramp(L,R)"</code></dt>
  <dd>
    <p>Set initial condition to a linear ramp having value <code class="highlighter-rouge">L</code> @ x=0 and <code class="highlighter-rouge">R</code> @ x=<script type="math/tex">L_x</script>.</p>
  </dd>
  <dt>Step, <code class="highlighter-rouge">ic="step(L,Mx,R)"</code></dt>
  <dd>
    <p>Set initial condition to a step function having value <code class="highlighter-rouge">L</code> for all x&lt;Mx and value <code class="highlighter-rouge">R</code> for all x&gt;=Mx.</p>
  </dd>
  <dt>Random, <code class="highlighter-rouge">ic="rand(S,B,A)"</code></dt>
  <dd>
    <p>Set initial condition to random values in the range [B-A,B+A] using seed value <code class="highlighter-rouge">S</code>.</p>
  </dd>
  <dt>Sin, <code class="highlighter-rouge">ic="sin(Pi*x)"</code></dt>
  <dd>
    <p>Set initial condition to <script type="math/tex">sin(\pi x)</script>.</p>
  </dd>
  <dt>Spikes, <code class="highlighter-rouge">ic="spikes(C,A0,X0,A1,X1,...)"</code></dt>
  <dd>
    <p>Set initial condition to a constant value, <code class="highlighter-rouge">C</code> with any number of <em>spikes</em> where each spike is the pair, <code class="highlighter-rouge">Ai</code> specifying the spike amplitude and <code class="highlighter-rouge">Xi</code> specifying its position in, x.</p>
  </dd>
</dl>



                        
                        <p><a href='../../lessons'>Back to all ATPESC 2018 Lessons</a></p>
                        

		</article>
	</div><!-- /.medium-12.columns -->
</div><!-- /.row -->




	
	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" href="#top-of-page">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->


    <footer id="footer-content" class="bg-grau">
      <div id="footer">
        <div class="row">
          <div class="medium-6 large-5 columns">
            <h5 class="shadow-black">About This Site</h5>

            <p class="shadow-black">
              <a href="https://software-carpentry.org">Software Carpentry</a> Style Lessons for Numerical Libraries
              <a href="http://localhost:4000/info/">More ›</a>
              Created by <a href="https://github.com/markcmiller86">Mark C Miller</a> with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> based on <a href="http://phlow.github.io/feeling-responsive/">Feeling Responsive</a>.</p>
            </p>
          </div><!-- /.large-6.columns -->

          <div class="small-6 medium-3 large-3 columns">
            <ul class="inline-list social-icons">
            
              <li><a href="https://fastmath-scidac.llnl.gov" target="_blank" class="icon-home" title="FASTMath"></a></li>
            
              <li><a href="https://www.youtube.com/playlist?list=PLGj2a3KTwhRZKjI7pRFxQDBORsswJAdJt" target="_blank" class="icon-youtube" title="ATPESC-2017 Numerical Libaries"></a></li>
            
              <li><a href="https://www.youtube.com/channel/UCEkJLPAMOUsjC_RXGFcVq-A/videos" target="_blank" class="icon-youtube" title="IDEAS on YouTube"></a></li>
            
              <li><a href="http://twitter.com/exascaleproject" target="_blank" class="icon-twitter" title="Exascale Project on Twitter"></a></li>
            
            </ul>

                        <a class="button left r15 tiny radius" href="https://github.com/xsdk-project/ATPESC2018HandsOnLessons/edit/gh-pages/_lessons/hand_coded_heat/lesson.md">Edit This Page On GitHub</a>



          </div><!-- /.large-3.columns -->
        </div><!-- /.row -->

      </div><!-- /#footer -->

    </footer>

	

	


<script src="http://localhost:4000/assets/js/javascript.min.js"></script>



<script>
    $("#masthead").backstretch("http://localhost:4000/images/Differential-Equations-e1509686869201.png", {fade: 700});
    $("#masthead-with-text").backstretch("http://localhost:4000/images/Differential-Equations-e1509686869201.png", {fade: 700});
</script>












</body>
</html>

