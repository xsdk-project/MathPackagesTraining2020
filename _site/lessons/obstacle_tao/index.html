<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>The Obstacle Problem</title>

    <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive.css">

  

	<script src="http://localhost:4000/assets/js/modernizr.min.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
	<script>
		WebFont.load({
			google: {
				families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ]
			}
		});
	</script>

	<noscript>
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'>
	</noscript>


	<!-- Search Engine Optimization -->
	<meta name="description" content="Leveraging interoperability between PETSc/TAO and MFEM">
	<meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ">
	<meta name="msvalidate.01" content="0FB4C028ABCF07C908C54386ABD2D97F" >
	
	<link rel="author" href="https://plus.google.com/u/0/118311555303973066167">
	
	
	<link rel="canonical" href="http://localhost:4000/lessons/obstacle_tao/">


	<!-- Facebook Open Graph -->
	<meta property="og:title" content="The Obstacle Problem">
	<meta property="og:description" content="Leveraging interoperability between PETSc/TAO and MFEM">
	<meta property="og:url" content="http://localhost:4000/lessons/obstacle_tao/">
	<meta property="og:locale" content="en_EN">
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="ATPESC 2018 Math Library Hands On Exercises">
	
	<meta property="article:author" content="https://www.facebook.com/phlow.media">


	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="phlow">
	<meta name="twitter:creator" content="phlow">
	<meta name="twitter:title" content="The Obstacle Problem">
	<meta name="twitter:description" content="Leveraging interoperability between PETSc/TAO and MFEM">
	
	

	<link type="text/plain" rel="author" href="http://localhost:4000/humans.txt">

	

	

	<link rel="icon" sizes="32x32" href="http://localhost:4000/assets/img/favicon-32x32.png">

	<link rel="icon" sizes="192x192" href="http://localhost:4000/assets/img/touch-icon-192x192.png">

	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://localhost:4000/assets/img/apple-touch-icon-180x180-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/assets/img/apple-touch-icon-152x152-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/img/apple-touch-icon-144x144-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/assets/img/apple-touch-icon-120x120-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/img/apple-touch-icon-114x114-precomposed.png">

	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/assets/img/apple-touch-icon-76x76-precomposed.png">

	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/img/apple-touch-icon-72x72-precomposed.png">

	<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/assets/img/apple-touch-icon-precomposed.png">	

	<meta name="msapplication-TileImage" content="http://localhost:4000/assets/img/msapplication_tileimage.png">

	<meta name="msapplication-TileColor" content="#fabb00">


	

        
	   <!-- MathJax Config
                    CommonHTML: {
                        scale: 200
                    }
            <script type="text/x-mathjax-config">
                MathJax.Hub.Config({
                    displayAlign: "left"
                });
            </script>
            -->
            <script type="text/javascript" async
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async>
            </script>
            <script type="text/x-mathjax-config">
                MathJax.Hub.Config({
                    TeX: { 
                        equationNumbers: {  autoNumber: "all"  }
                    }
                });
            </script>
        

</head>
<body id="top-of-page" class="page-fullwidth">
        

	
	
<div id="navigation" class="sticky">
  <nav class="top-bar" role="navigation" data-topbar>
    <ul class="title-area">
      <li class="name">
      <h1 class="show-for-small-only"><a href="http://localhost:4000" class="icon-tree"> ATPESC 2018 Math Library Hands On Exercises</a></h1>
    </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span>Nav</span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        
              

              

          
          
        
              

              

          
          
        
              

              

          
          
        
              

              

          
          
        
        
      </ul>

      <ul class="left">
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/">Intro</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/about_your_day/">About Your Day</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/setup_instructions/">Setup Instructions</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/atpesc_2018_agenda/">Today&#39;s Agenda</a></li>
                    

                      

                      <li><a  href="https://www.alcf.anl.gov/user-guides" target="_blank">ALCF User Guides</a></li>
                    

                      

                      <li><a  href="https://hangouts.google.com/group/wuWDDdPe4mX1u0v83" target="_blank">Open Chat</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/pages/one_on_one_schedule.html">One-on-One Schedule</a></li>
                    

                      

                      <li><a  href="https://goo.gl/forms/B7UFpBvEOJbC58oJ2" target="_blank">Submit a Show Your Work</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/lessons/">Lessons</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/lessons/hand_coded_heat/">Hand Coded Heat</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/mfem_convergence/">Meshing and Discretization (MFEM)</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/pumi/">MFEM+PUMI Adaptive Workflow</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/time_integrators/">Time Integration &amp; Non-Linear Solvers</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/krylov_amg/">Krylov Solvers and Algebraic Multigrid</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/superlu_mfem/">Sparse Direct Solvers</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/adjoint/">Numerical Optimization (Adjoint)</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/lessons/obstacle_tao">Numerical Optimization</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="https://fastmath-scidac.org/software-catalog.html" target="_blank">Packages</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://mfem.org" target="_blank">MFEM</a></li>
                    

                      

                      <li><a  href="https://www.scorec.rpi.edu/pumi" target="_blank">PUMI</a></li>
                    

                      

                      <li><a  href="https://www.mcs.anl.gov/petsc/" target="_blank">PETSc</a></li>
                    

                      

                      <li><a  href="https://computation.llnl.gov/projects/hypre-scalable-linear-solvers-multigrid-methods" target="_blank">HYPRE</a></li>
                    

                      

                      <li><a  href="http://crd-legacy.lbl.gov/~xiaoye/SuperLU" target="_blank">SuperLU</a></li>
                    

                      

                      <li><a  href="http://www.mcs.anl.gov/research/projects/tao/tao-deprecated/index.html" target="_blank">Tao</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
              

              

          
          

            
            

              <li class="has-dropdown">
                <a  href="http://localhost:4000/contributing_guide/">Contributing</a>

                  <ul class="dropdown">
                    

                      

                      <li><a  href="http://localhost:4000/contributing_guide/">Contributing Guide</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/info/">Why the new theme?</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/headers/">Many Header Styles</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/design/">Many Design Options</a></li>
                    

                      

                      <li><a  href="http://localhost:4000/documentation/">Full Documentation</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->

	

	

<div id="masthead">
	<div class="row">
		<div class="small-12 columns">
			<a id="logo" href="http://localhost:4000/" title="ATPESC 2018 Math Library Hands On Exercises – So my code will see the future">
				<img src="http://localhost:4000/assets/img/logo.png" alt="ATPESC 2018 Math Library Hands On Exercises – So my code will see the future">
			</a>
		</div><!-- /.small-12.columns -->
	</div><!-- /.row -->
</div><!-- /#masthead -->










	


<div class="row t30">
	<div class="medium-12 columns">
		<article>
			<header>
				<p class="subheadline">Numerical Optimization</p>
				<h1>The Obstacle Problem</h1>
			</header>

			
			<p class="teaser">
				Leveraging interoperability between PETSc/TAO and MFEM
			</p>
			

			<h2 id="at-a-glance">At a Glance</h2>
<!-- (Expected # minutes to complete) %% temporarily omit -->

<table>
  <tbody>
    <tr>
      <td>Questions</td>
      <td>Objectives</td>
      <td>Key Points</td>
    </tr>
    <tr>
      <td>1. What is optimization?</td>
      <td>Understand the basic principles</td>
      <td>Optimization seeks to minimize or maximize a cost function with respect to its inputs</td>
    </tr>
    <tr>
      <td>2. How to use TAO for derivative-based optimization?</td>
      <td>Understand the basic TAO interfaces</td>
      <td>TAO is a PETSc subpackage for numerical optimization</td>
    </tr>
    <tr>
      <td>3. What is the effect of second-order information in derivative-based optimization?</td>
      <td>Understand how second-derivatives improve performance of optimization algorithms</td>
      <td>Hessian information helps the optimization converge to a local optimum rapidly</td>
    </tr>
  </tbody>
</table>

<p><strong>Note:</strong> To run the application in this lesson</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd HandsOnLessons/obstacle_tao
make obstacle
./obstacle -tao_monitor -tao_view
</code></pre></div></div>

<h2 id="brief-introduction-to-optimization">Brief Introduction to Optimization</h2>

<p>Numerical optimization algorithms seek to find the input variables (referred to as “control” or “design” variables) that minimize (or maximize) a quantity of interest (such as cost or performance) subject to constraints (such as bounds on resources). A general numerical optimization problems is stated as</p>

<script type="math/tex; mode=display">\min_u \quad f(u) \quad \text{subject to} \quad c(u) \leq 0, \quad h(u) = 0</script>

<p>In this lesson, we will focus on derivative-based optimization algorithms – methods that utilize information about the sensitivity of the objective function <script type="math/tex">f(u): \in \mathbb{R}^n \rightarrow \mathbb{R}</script> to its inputs <script type="math/tex">x \in \mathbb{R}^n</script>. In the convex unconstrained case, the derivative of the objective function with respect to the parameters, <script type="math/tex">\nabla f(u)</script>, is zero at the every minimum of <script type="math/tex">f(u)</script>.  Therefore, we can apply a Newton to solve the system of equations <script type="math/tex">\nabla f(u) = 0</script>. Consequently, we solve the system <script type="math/tex">\nabla^2 f(u^k) p=-\nabla f(u^k)</script> at every Newton iteration for the step direction <script type="math/tex">p</script>, where <script type="math/tex">\nabla^2 f(u^k)</script> is the Hessian at <script type="math/tex">x^k</script> and <script type="math/tex">\nabla f(u^k)</script> is the gradient of the objective function. When the Hessian is not available directly, it can be approximated from gradient information by using finite differences or by using <a href="https://en.wikipedia.org/wiki/Quasi-Newton_method">quasi-Newton methods</a>. The Newton method is augmented with a globalization technique (such as a line search or a trust region) to ensure that the algorithm converges.</p>

<p>For more information on the subject, we refer the reader to <a href="https://books.google.com/books/about/Linear_and_Nonlinear_Optimization.html?id=uOJ-Vg1BnKgC"><em>Linear and Nonlinear Optimization</em> by Igor Griva, Stephen G. Nash and Ariela Sofer</a> and <a href="https://books.google.com/books?id=VbHYoSyelFcC&amp;dq=Nonlinear+Optimization+Nocedal&amp;source=gbs_navlinks_s"><em>Numerical Optimization</em> by Jorge Nocedal and Stephen Wright</a>.</p>

<h2 id="problem-formulation">Problem Formulation</h2>

<p>The obstacle problem aims to find the equilibrium of an elastic membrane with a fixed boundary that is stretched over a given obstacle. The mathematical formulation seeks to minimize the Dirichlet energy functional subject to constraints associated with the Dirichlet boundary and the obstacle,</p>

<script type="math/tex; mode=display">\min_u \quad J(u) = \int_\Omega |\nabla u|^2 dx \quad \text{subject to} \quad u(x) = 0 \; \text{on} \; \partial\Omega, \quad u(x) \geq \phi(x) \; \text{elsewhere}</script>

<p>where <script type="math/tex">u</script> represents the control variables, <script type="math/tex">x</script> represents the discrete nodal coordinates in the domain <script type="math/tex">\Omega</script>, and <script type="math/tex">\phi(x)</script> is the obstacle function. This problem is equivalent to a variational inequality involving the Laplace equation <script type="math/tex">\Delta u = 0</script> and the obstacle.</p>

<p>In this lesson, we will solve the obstacle problem with the numerical optimization formulation using algorithms in <a href="http://www.mcs.anl.gov/petsc">PETSc/TAO</a>.  Calculation of the objective (the Dirichlet energy function) and its gradient and Hessian will be performed using <a href="http://mfem.org">MFEM</a>. We will use two gradient-based algorithms available in TAO, one requiring only gradient information and the other requiring both the gradient and the Hessian. We will then examine the improvement in convergence achieved by utilizing second-order information into the problem.</p>

<p>Source code for this problem is available in <a href="/lessons/obstacle_tao/obstacle.cpp">obstacle.cpp</a> and the accompanying makefile in <a href="/lessons/obstacle_tao/makefile">makefile</a>.  The mesh file used in this lesson is available in <a href="/lessons/obstacle_tao/star.mesh">star.mesh</a>. All problem files are also hosted under <code class="highlighter-rouge">examples/atpesc/tao</code> directory of the MFEM <code class="highlighter-rouge">atpesc-dev</code> branch <a href="https://github.com/mfem/mfem/tree/atpesc-dev/examples/atpesc/tao">here</a>.</p>

<h2 id="the-obstacle-function">The Obstacle Function</h2>

<p>The C++ function representing the obstacle in the problem is written as an MFEM <code class="highlighter-rouge">FunctionCoefficient</code> object. We first define a simple function that takes an MFEM <code class="highlighter-rouge">Vector</code> defining the <script type="math/tex">(x, y, z)</script> coordinates of a single point in the domain and returns the corresponding obstacle value at that location.</p>

<p>In this test case, we define a ring-shaped obstacle centered at the origin of the domain, with a height of 1.0, an outer radius of 4.0, and a ring thickness of 0.05. The ring must have a finite thickness in order to capture sufficient quadrature points in the finite-element space. Outside of the ring itself, the obstacle function returns a value of “negative infinity” (as defined by a PETSc constant <code class="highlighter-rouge">PETSC_NINFINITY</code>). This will help produce a lower-bound vector for TAO that will effectively treat the degrees of freedom outside the obstacle as unbounded below.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define a ring-shaped obstacle function centered at the origin with radius 0.4</span>
<span class="kt">double</span> <span class="nf">RingObstacle</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span>                            <span class="c1">// thickness</span>
  <span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>     <span class="c1">// radial location of the point from the origin</span>
  <span class="kt">double</span> <span class="n">rad</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>                           <span class="c1">// outer radius </span>
  <span class="kt">double</span> <span class="n">ul</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>                    
  <span class="kt">double</span> <span class="n">ll</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">rad</span><span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">ll</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ul</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// point is inside the ring</span>
    <span class="k">return</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// point is outside the ring</span>
    <span class="k">return</span> <span class="n">PETSC_NINFINITY</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This ring shaped obstacle function is then converted into a <code class="highlighter-rouge">FunctionCoefficient</code> object and projected onto a <code class="highlighter-rouge">GridFunction</code>. Additionally, we also project a zero <code class="highlighter-rouge">ConstantCoefficient</code> onto the Dirichlet boundary.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ConstantCoefficient</span> <span class="n">zero</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
<span class="n">FunctionCoefficient</span> <span class="n">obs</span><span class="p">(</span><span class="n">RingObstacle</span><span class="p">);</span>

<span class="n">GridFunction</span> <span class="n">lb</span><span class="p">(</span><span class="n">fespace</span><span class="p">);</span>                      <span class="c1">// grid function for the lower bound in the optimization</span>
<span class="n">lb</span><span class="p">.</span><span class="n">ProjectCoefficient</span><span class="p">(</span><span class="n">obs</span><span class="p">);</span>                    <span class="c1">// project the obstacle onto the grid</span>
<span class="n">lb</span><span class="p">.</span><span class="n">ProjectBdrCoefficient</span><span class="p">(</span><span class="n">zero</span><span class="p">,</span> <span class="n">ess_tdof_list</span><span class="p">);</span> <span class="c1">// project the zero Dirichlet bound onto the grid</span>
</code></pre></div></div>

<p>In this lesson, you can define a new obstacle function of your choice and re-run the problem to see how the obstacle changes the solution and the convergence of the optimization algorithms.</p>

<h2 id="using-tao">Using TAO</h2>

<p>Creating, setting up, and using a TAO optimization algorithm is similar to using SNES solvers in PETSc.</p>

<p>First, we implement a <code class="highlighter-rouge">FormFunctionGradient()</code> function that is given a design vector <code class="highlighter-rouge">X</code> and computes the cost function value and its gradient vector. This function is sufficient for quasi-Newton algorithms that require only gradient information.  For Newton methods that require the Hessian, we also provide the <code class="highlighter-rouge">FormHessian()</code> function that computes the Hessian matrix as a PETSc <code class="highlighter-rouge">Mat</code> object.  For matrix-free Hessian implementations, this <code class="highlighter-rouge">Mat</code> object can be a <code class="highlighter-rouge">MATSHELL</code> type that provide the matrix-free <code class="highlighter-rouge">MatMult</code> operation. Examples of these functions are available in <a href="/lessons/obstacle_tao/obstacle.cpp">obstacle.cpp</a>.</p>

<p>With these functions defined, we can now create the TAO solver, configure it, and apply the numerical optimization
algorithm.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoCreate</span><span class="p">(</span><span class="n">PETSC_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tao</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetType</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">TAOBNLS</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetInitialVector</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">X</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetObjectiveAndGradientRoutine</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">FormFunctionGradient</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">user</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetHessianRoutine</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">H</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">H</span><span class="p">,</span> <span class="n">FormHessian</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">user</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetVariableBounds</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">XL</span><span class="p">,</span> <span class="n">XU</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetMonitor</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">Monitor</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">user</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSetFromOptions</span><span class="p">(</span><span class="n">tao</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">TaoSolve</span><span class="p">(</span><span class="n">tao</span><span class="p">);</span><span class="n">CHKERRQ</span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
</code></pre></div></div>

<p>Note that these operations must be preceded by <code class="highlighter-rouge">PetscInitialize()</code> and <code class="highlighter-rouge">PetscFinalize()</code> must be called after the solution is computed and all PETSc objects are destroyed.</p>

<h2 id="results">Results</h2>

<p>Once compiled with <code class="highlighter-rouge">make obstacle</code>, the problem can be run with <code class="highlighter-rouge">./obstacle -tao_monitor -tao_view</code>.</p>

<p>Adding the <code class="highlighter-rouge">-tao_type bqnls</code> flag uses the bounded quasi-Newton line-search algorithm in TAO to solve the problem. In this algorithm, the Hessian of the objective function is approximated using the <a href="https://en.wikipedia.org/wiki/Broyden–Fletcher–Goldfarb–Shanno_algorithm">Broyden-Fletched-Goldfarb-Shanno (BFGS) approximation</a>. The TAO implementation is a limited-memory quasi-Newton algorithm, where only a limited number of previous steps are used to construct the approximate Hessian (default: 5 steps). This limited-memory quasi-Newton algorithm converges in 293 nonlinear iterations on the obstacle problem. The animation below shows the shape of the solution during the optimization.</p>

<p><a href="/lessons/obstacle_tao/bqnls.gif"><img src="bqnls.gif" width="600" /></a></p>

<p>Running with the <code class="highlighter-rouge">-tao_type bnls</code> flag uses the bounded Newton line-search algorithm where the exact Hessian is provided by the MFEM implementation instead of being approximated. Linear solves involving this Hessian matrix are performed to compute the Newton direction by applying the preconditioned conjugate gradient method with an inexact Cholesky preconditioner available in PETSc. In contrast with the quasi-Newton method, the Newton algorithm converges in 3 iterations.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Iteration 1</th>
      <th style="text-align: center">Iteration 2</th>
      <th style="text-align: center">Iteration 3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><a href="/lessons/obstacle_tao/bnls_init.png"><img src="bnls_init.png" width="400" /></a></td>
      <td style="text-align: center"><a href="/lessons/obstacle_tao/bnls_mid.png"><img src="bnls_mid.png" width="400" /></a></td>
      <td style="text-align: center"><a href="blns_final.gif"><img src="bnls_final.png" width="400" /></a></td>
    </tr>
  </tbody>
</table>

<h2 id="further-reading">Further Reading</h2>

<p><a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manual.pdf">PETSc Manual</a><br />
<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/tao_manual.pdf">TAO Manual</a></p>



                        
                        <p><a href='../../lessons'>Back to all ATPESC 2018 Lessons</a></p>
                        

		</article>
	</div><!-- /.medium-12.columns -->
</div><!-- /.row -->




	
	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" href="#top-of-page">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->


    <footer id="footer-content" class="bg-grau">
      <div id="footer">
        <div class="row">
          <div class="medium-6 large-5 columns">
            <h5 class="shadow-black">About This Site</h5>

            <p class="shadow-black">
              <a href="https://software-carpentry.org">Software Carpentry</a> Style Lessons for Numerical Libraries
              <a href="http://localhost:4000/info/">More ›</a>
              Created by <a href="https://github.com/markcmiller86">Mark C Miller</a> with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> based on <a href="http://phlow.github.io/feeling-responsive/">Feeling Responsive</a>.</p>
            </p>
          </div><!-- /.large-6.columns -->

          <div class="small-6 medium-3 large-3 columns">
            <ul class="inline-list social-icons">
            
              <li><a href="https://fastmath-scidac.llnl.gov" target="_blank" class="icon-home" title="FASTMath"></a></li>
            
              <li><a href="https://www.youtube.com/playlist?list=PLGj2a3KTwhRZKjI7pRFxQDBORsswJAdJt" target="_blank" class="icon-youtube" title="ATPESC-2017 Numerical Libaries"></a></li>
            
              <li><a href="https://www.youtube.com/channel/UCEkJLPAMOUsjC_RXGFcVq-A/videos" target="_blank" class="icon-youtube" title="IDEAS on YouTube"></a></li>
            
              <li><a href="http://twitter.com/exascaleproject" target="_blank" class="icon-twitter" title="Exascale Project on Twitter"></a></li>
            
            </ul>

                        <a class="button left r15 tiny radius" href="https://github.com/xsdk-project/ATPESC2018HandsOnLessons/edit/gh-pages/_lessons/obstacle_tao/lesson.md">Edit This Page On GitHub</a>



          </div><!-- /.large-3.columns -->
        </div><!-- /.row -->

      </div><!-- /#footer -->

    </footer>

	

	


<script src="http://localhost:4000/assets/js/javascript.min.js"></script>



<script>
    $("#masthead").backstretch("http://localhost:4000/images/xsdk_logo_wide.png", {fade: 700});
    $("#masthead-with-text").backstretch("http://localhost:4000/images/xsdk_logo_wide.png", {fade: 700});
</script>












</body>
</html>

